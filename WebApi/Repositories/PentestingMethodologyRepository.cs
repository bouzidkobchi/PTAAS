using Microsoft.EntityFrameworkCore;
using WebApi.Data;
using WebApi.DTOs;
using WebApi.Models;

namespace WebApi.Repositories
{
    public class PentestingMethodologyRepository : BaseRepository<PentestingMethodology>
    {
        public PentestingMethodologyRepository(AppDbContext context) : base(context){}
        public IEnumerable<PentestingMethodologyDTO> GetPage(int pageNumber = 1 , int pageSize = 10)
        {
            return _context.PentestingMethodologies
                .AsNoTracking()
                .Skip((pageNumber - 1) *pageSize)
                .Take(pageSize)
                .Select(m => new PentestingMethodologyDTO(m))
                .ToList();
        }

        public IEnumerable<PentrationTest>? GetPage_Tests(string methodId, int pageNumber = 1 , int pageSize = 10)
        {
            var method = _context.PentestingMethodologies
                .AsNoTracking()
                .Include(m => m.Tests)
                .FirstOrDefault(m => m.Id == methodId);

            if (method == null) return null;

            return method.Tests
                .Skip((pageNumber - 1) * pageSize)
                .Take(pageSize);
        }
    }
}
