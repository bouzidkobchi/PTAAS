using Microsoft.EntityFrameworkCore;
using WebApi.Data;
using WebApi.DTOs;
using WebApi.Models;

namespace WebApi.Repositories
{
    public class PentestingMethodologyRepository : BaseRepository<TestingMethodology>
    {
        public PentestingMethodologyRepository(AppDbContext context) : base(context){}
        public IEnumerable<TestingMethodology> GetPage(int pageNumber = 1 , int pageSize = 10)
        {
            return _context.Methodologies
                .AsNoTracking()
                .Skip((pageNumber - 1) * pageSize)
                .Take(pageSize)
                .Include(m => m.Tests)
                .ToList();
        }

        public override TestingMethodology? Get(string id)
        {
            return _context.Methodologies.Include(m => m.Tests).FirstOrDefault(m => m.Id == id);
        }

        public IEnumerable<PentrationTest>? GetPage_Tests(string methodId, int pageNumber = 1 , int pageSize = 10)
        {
            var method = _context.Methodologies
                .AsNoTracking()
                .Include(m => m.Tests)
                .FirstOrDefault(m => m.Id == methodId);

            if (method == null) return null;

            return method.Tests
                .Skip((pageNumber - 1) * pageSize)
                .Take(pageSize);
        }
    }
}
